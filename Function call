%matplotlib inline
import matplotlib.pyplot as plt

import requests
import json

import os
import pandas as pd
import numpy as np

from bs4 import BeautifulSoup

import boto3

from IPython.display import HTML, display

nasa = requests.get("https://api.nasa.gov/neo/rest/v1/feed?start_date=2023-09-07&end_date=2023-09-08&api_key=XwVHPFh2zHGkoQZ3QmLtDqyncNjhdloY07lr9868")
nasa.json()


def request_nasa(start_date_str, end_date_str, key_str):
    template_url = "https://api.nasa.gov/neo/rest/v1/feed?start_date={start_date}&end_date={end_date}&api_key={key}"
    try:
        request_url = template_url.format(
            start_date=start_date_str,
            end_date=end_date_str,
            key=key_str)
        r = requests.get(request_url)
        return r.json()
    except Exception as e:
        print(e)


d = request_nasa("2023-09-25","2023-09-29","XwVHPFh2zHGkoQZ3QmLtDqyncNjhdloY07lr9868")
d["near_earth_objects"].keys()


def df_from_nasa_data(nasa_data, datestr):
    return pd.DataFrame(nasa_data["near_earth_objects"][datestr])


raw = df_from_nasa_data(d,"2023-09-28")
dia = raw["estimated_diameter"]
close = raw['close_approach_data']
close

dia_list = dia.tolist()
dia_units_df = pd.json_normalize(dia_list)
col_index_1 = raw.columns.get_loc("estimated_diameter")
left = raw.iloc[:, :col_index_1]
right = raw.iloc[:, col_index_1:]
result_df = pd.concat([left, dia_units_df, right], axis=1)
result_df = result_df.drop('estimated_diameter', axis=1)
result_df

close_df = pd.DataFrame([x[0] for x in close])
close_df
vel = close_df['relative_velocity']
vel_list = vel.tolist()
vel_units_df = pd.json_normalize(vel_list)
miss = close_df['miss_distance']
miss_list = miss.tolist()
miss_units_df = pd.json_normalize(miss_list)

close_df = close_df.drop(['relative_velocity', 'miss_distance'], axis=1)
close_df

col_index_close = result_df.columns.get_loc("close_approach_data")
result_df = result_df.drop('close_approach_data', axis=1)
left_close = result_df.iloc[:, :col_index_close]
right_close = result_df.iloc[:, col_index_close:]
final_df= pd.concat([left_close, close_df, vel_units_df, miss_units_df , right_close], axis=1)
final_df

final_df.head().style
